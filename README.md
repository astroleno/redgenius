# RedGenius - 小红书+Bento风格内容卡片生成器

## 项目简介

RedGenius 是一个自动化内容生成工具，专门用于创建小红书风格的爆款图文内容。它结合了小红书的内容策略和Bento Grid的现代设计风格，能够自动生成结构化内容并渲染为精美的PNG图片卡片。

## 核心功能

### 1. 结构化内容生成 (Step 1)
- **智能分析用户输入**：提取关键信息，理解内容主题
- **爆款内容策略**：生成具有钩子、金句、互动引导的内容
- **情绪曲线调整**：优化内容的情感起伏，增强用户共鸣
- **热门标签生成**：自动生成5-8个相关热门标签
- **JSON结构化输出**：生成标准化的内容结构，便于后续处理

### 2. HTML卡片生成 (Step 2)
- **5张独立卡片**：每张卡片呈现不同的内容角度
- **Bento风格设计**：现代极简的网格布局设计，支持灵活排版
- **颜色规范**：严格遵循黑(#111111)、白(#FFFFFF)、橙(#ffa500)配色
- **排版创新**：支持网格、卡片、瀑布流等多种布局方式
- **品牌元素**：统一的视觉风格和品牌标识

### 3. PNG图片渲染
- **批量渲染**：自动将HTML转换为1125x1500px的PNG图片
- **高质量输出**：保持设计细节和视觉效果
- **透明背景**：支持透明背景，便于后续使用
- **自动补齐**：确保始终输出5张卡片，不足时自动补齐

## 最新优化 (2025-06-25)

### Prompt优化改进
1. **角色设定整合**：简化了Step 2的角色设定，去掉过于复杂的规则
2. **排版灵活性**：允许使用不同的布局方式（网格、卡片、瀑布流等）
3. **设计规范明确**：明确颜色规则和Bento风格要求
4. **创新空间**：鼓励在保持规范的基础上进行视觉创新

### 技术改进
1. **自动补齐机制**：当API返回不足5张卡片时，自动补齐空白卡片
2. **错误处理增强**：更好的API空返回处理机制
3. **日志优化**：更详细的调试信息和状态跟踪
4. **两步生成流程**：第一步生成结构化JSON内容，第二步生成HTML并渲染为PNG，确保内容完整性和渲染质量

## 技术架构

### 核心技术栈
- **Python 3.8+**：主要开发语言
- **OpenAI API**：结构化内容生成
- **Gemini API**：HTML内容生成
- **HTML2Image**：HTML到PNG图片转换
- **BeautifulSoup**：HTML内容解析
- **TailwindCSS**：现代化CSS框架

### 项目结构
```
redgenius/
├── main.py              # 主程序入口
├── requirements.txt     # 依赖包列表
├── test/
│   ├── prompt_0.md     # 内容生成提示词
│   └── test.md         # 用户输入测试文件
├── outputs/            # 输出结果目录
│   └── YYYYMMDD_HHMMSS/ # 时间戳命名的输出文件夹
│       ├── output.json  # 结构化内容
│       ├── output.html  # HTML源码
│       ├── image_1.png  # 渲染的PNG图片
│       ├── image_2.png
│       ├── ...
│       └── post.txt     # 文案和标签
└── main.log            # 运行日志
```

## 安装和使用

### 1. 环境准备
```bash
# 克隆项目
git clone [项目地址]
cd redgenius

# 安装依赖
pip install -r requirements.txt
```

### 2. 环境变量配置
创建 `.env` 文件并配置以下变量：
```env
# Step 1 API配置（用于结构化内容生成）
STEP1_API_KEY=your_openai_api_key
STEP1_BASE_URL=https://api.openai.com/v1
STEP1_MODEL=gpt-4

# Step 2 API配置（用于HTML生成）
STEP2_API_KEY=your_gemini_api_key
STEP2_BASE_URL=https://generativelanguage.googleapis.com
STEP2_MODEL=gemini-pro
```

### 3. 运行程序
```bash
python main.py
```

## 输出说明

### 1. 结构化内容 (output.json)
```json
{
  "hook_headline": "极具吸引力的钩子金句",
  "caption": {
    "body": "主体文案内容，包含故事性和情绪张力",
    "closing": "总结金句和互动引导"
  },
  "tags": ["标签1", "标签2", "标签3"],
  "bentobox_slides": [
    {
      "slide_type": "Hook_Cover",
      "headline": "卡片标题",
      "body": "卡片正文内容"
    }
    // ... 共5张卡片
  ]
}
```

### 2. HTML源码 (output.html)
- 包含5段完整的HTML代码
- 每段用 `===CARD===` 分隔
- 每段都是独立的HTML文档，可直接渲染

### 3. PNG图片 (image_1.png ~ image_5.png)
- 尺寸：1125x1500px
- 格式：PNG
- 风格：Bento Grid + 小红书风格
- 内容：包含标题、正文、标签、品牌标识

### 4. 文案文件 (post.txt)
```
caption.body: 主体文案内容
caption.closing: 总结文案内容
tags: 标签1, 标签2, 标签3
```

## 内容策略

### 1. 爆款内容要素
- **钩子金句**：开头极具吸引力，引发用户点击
- **故事性**：用讲故事的方式传递信息
- **情绪共鸣**：触及用户痛点，引发强烈共鸣
- **互动引导**：鼓励用户在评论区分享经历
- **热门标签**：使用相关热门标签增加曝光

### 2. 5张卡片内容策略
1. **Hook_Cover**：捕捉用户痛苦场景，暗示解决方案
2. **Insight_Point**：提出颠覆性观点，挑战用户认知
3. **Solution_Kit**：提供具体解决方案和步骤
4. **Principle_Deep_Dive**：深入底层原理，用比喻解释
5. **Summary_CTA**：总结蜕变过程，引导行动

### 3. 设计风格
- **主色调**：黑色(#111111) + 白色(#FFFFFF) + 橙色(#ffa500)
- **布局**：Bento Grid风格，网格对齐
- **字体**：层次分明，重点突出
- **留白**：充足的留白空间，提升视觉体验

## 故障排除

### 常见问题

1. **JSON解析失败**
   - 检查API返回内容是否包含代码块标记
   - 查看 `debug_failed_json.txt` 文件了解具体错误
   - 确保prompt中明确要求只输出JSON格式

2. **HTML渲染不完整**
   - 检查是否生成了5张卡片
   - 查看日志中的分割信息
   - 确认每张卡片内容不为空

3. **PNG渲染失败**
   - 检查Html2Image参数是否正确
   - 确认HTML代码格式完整
   - 查看失败的HTML文件进行调试

### 日志分析
程序会生成详细的日志文件 `main.log`，包含：
- API调用状态
- 内容生成过程
- 错误信息和调试数据
- 渲染结果统计

## 自定义配置

### 1. 修改提示词
编辑 `test/prompt_0.md` 文件：
- 调整内容策略和风格要求
- 修改卡片结构和布局
- 自定义品牌元素和视觉风格

### 2. 调整输出参数
在 `main.py` 中修改：
- 图片尺寸和格式
- 输出目录结构
- 日志级别和格式

### 3. 更换API模型
在 `.env` 文件中配置：
- 不同的OpenAI模型
- 其他AI服务提供商
- 自定义API端点

## 开发计划

### 近期优化
- [ ] 支持更多内容模板
- [ ] 增加批量处理功能
- [ ] 优化图片渲染质量
- [ ] 添加内容审核功能

### 长期规划
- [ ] Web界面开发
- [ ] 多平台内容适配
- [ ] 智能内容推荐
- [ ] 数据分析和优化

## 贡献指南

欢迎提交Issue和Pull Request来改进项目：
1. Fork项目
2. 创建功能分支
3. 提交代码变更
4. 创建Pull Request

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 项目Issues：提交GitHub Issue
- wechat: aitoshuu

---

**注意**：使用前请确保已正确配置API密钥，并遵守相关服务的使用条款。

## 运行流程说明

### 两步生成流程

1. **第一步：结构化内容生成**
   - 读取用户输入和Step 1提示词
   - 调用OpenAI API生成结构化JSON内容
   - 包含标题、caption、tags和5张卡片的内容结构
   - 保存为output.json文件

2. **第二步：HTML生成和PNG渲染**
   - 将结构化内容传递给Step 2提示词
   - 调用Gemini API生成5段HTML卡片代码
   - 自动分割HTML内容为独立卡片
   - 使用Html2Image渲染每张卡片为PNG图片
   - 自动补齐机制确保始终输出5张卡片

### 技术特点
- **模块化设计**：两步独立，便于调试和优化
- **错误处理**：完善的异常处理和日志记录
- **自动补齐**：智能处理API返回内容不足的情况
- **高质量输出**：确保每张卡片都能正确渲染 